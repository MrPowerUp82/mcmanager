{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Console</title>
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <link href="{% static 'css/tailwind.css' %}" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
    <div class="container mx-auto">
        <h1 class="text-3xl font-bold mb-4">Minecraft Server Console</h1>
        <div class="mb-4">
            <button onclick="startServer()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Start Server</button>
            <button onclick="stopServer()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-2">Stop Server</button>
            <button onclick="forceStopServer()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-2">Force Stop Server</button>
            <button onclick="viewLogs()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">View Logs</button>
        </div>
        <form id="command-form" method="post" action="{% url 'send_command' %}" class="mb-4">
            {% csrf_token %}
            <input type="text" name="command" placeholder="Enter command" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-2">Send</button>
        </form>
        <div id="result" class="mb-4"></div>
        <div id="logs" class="bg-white p-4 border rounded shadow-md" style="white-space: pre-wrap;"></div>
    </div>
    <script>
        function startServer() {
            fetch("{% url 'start_server' %}")
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    location.reload();
                }
            });
        }

        function stopServer() {
            fetch("{% url 'stop_server' %}")
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    location.reload();
                }
            });
        }

        function forceStopServer() {
            fetch("{% url 'force_stop_server' %}")
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    location.reload();
                }
            });
        }

        function viewLogs() {
            fetch("{% url 'view_logs' %}")
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('logs').innerText = data.logs;
                } else {
                    alert(data.message);
                }
            });
        }

        document.getElementById('command-form').onsubmit = function(event) {
            event.preventDefault();
            var formData = new FormData(this);
            fetch("{% url 'send_command' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                document.getElementById('result').innerText = data.message;
            }).catch(error => {
                alert('An error occurred');
                document.getElementById('result').innerText = String(error);
            }).finally(() => {
                document.getElementById('command-form').reset();
                viewLogs();
            });
        };
    </script>
</body>
</html>
